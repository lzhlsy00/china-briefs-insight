<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Debug</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }
        .param {
            background: #f5f5f5;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }
        .error {
            background: #ffebee;
            border-left-color: #f44336;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Magic Email Auth Debug</h1>
        <div id="result"></div>
    </div>

    <script>
        const url = new URL(window.location.href);
        const params = {};
        
        // æ”¶é›†æ‰€æœ‰ URL å‚æ•°
        for (const [key, value] of url.searchParams.entries()) {
            params[key] = value;
        }
        
        // æ”¶é›† hash å‚æ•° (å¦‚æœæœ‰)
        if (url.hash) {
            const hashParams = new URLSearchParams(url.hash.substring(1));
            for (const [key, value] of hashParams.entries()) {
                params['hash_' + key] = value;
            }
        }

        const resultDiv = document.getElementById('result');
        
        // æ˜¾ç¤ºå®Œæ•´ URL
        resultDiv.innerHTML = `
            <div class="info">
                <strong>å®Œæ•´ URL:</strong>
                <pre>${window.location.href}</pre>
            </div>
        `;

        // æ˜¾ç¤ºæ‰€æœ‰å‚æ•°
        if (Object.keys(params).length > 0) {
            resultDiv.innerHTML += '<h2>URL å‚æ•°ï¼š</h2>';
            for (const [key, value] of Object.entries(params)) {
                resultDiv.innerHTML += `
                    <div class="param">
                        <strong>${key}:</strong> ${value.substring(0, 100)}${value.length > 100 ? '...' : ''}
                    </div>
                `;
            }
            
            // æ£€æŸ¥å…³é”®å‚æ•°
            if (params.code) {
                resultDiv.innerHTML += `
                    <div class="info success">
                        <strong>âœ… æ‰¾åˆ° code å‚æ•°</strong><br>
                        è¿™æ˜¯æ­£ç¡®çš„ Magic Link å›è°ƒï¼
                    </div>
                `;
            } else if (params.error || params.error_description) {
                resultDiv.innerHTML += `
                    <div class="info error">
                        <strong>âŒ å‘ç°é”™è¯¯</strong><br>
                        ${params.error_description || params.error}
                    </div>
                `;
            } else {
                resultDiv.innerHTML += `
                    <div class="info error">
                        <strong>âš ï¸ æœªæ‰¾åˆ° code å‚æ•°</strong><br>
                        è¿™å¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„ Magic Link å›è°ƒ
                    </div>
                `;
            }
        } else {
            resultDiv.innerHTML += `
                <div class="info">
                    <strong>â„¹ï¸ æ²¡æœ‰æ‰¾åˆ° URL å‚æ•°</strong><br>
                    è¿™ä¸ªé¡µé¢éœ€è¦é€šè¿‡ Magic Link è®¿é—®
                </div>
            `;
        }

        // æ£€æŸ¥ Supabase ç¯å¢ƒå˜é‡
        resultDiv.innerHTML += `
            <h2>ç¯å¢ƒæ£€æŸ¥ï¼š</h2>
            <div class="param">
                <strong>Current Origin:</strong> ${window.location.origin}
            </div>
            <div class="info">
                <strong>âœ… ç¡®è®¤äº‹é¡¹ï¼š</strong><br>
                1. Supabase æ§åˆ¶å°ä¸­çš„ Redirect URLs å¿…é¡»åŒ…å«ï¼š<br>
                <code>${window.location.origin}/</code><br>
                <code>${window.location.origin}/auth</code>
            </div>
        `;

        // æ·»åŠ æµ‹è¯•æŒ‰é’®
        resultDiv.innerHTML += `
            <div style="margin-top: 20px;">
                <a href="/" style="display: inline-block; background: #2196f3; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">
                    è¿”å›ä¸»é¡µ
                </a>
                <a href="/auth" style="display: inline-block; background: #4caf50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin-left: 10px;">
                    å‰å¾€ç™»å½•é¡µ
                </a>
            </div>
        `;
    </script>
</body>
</html>

